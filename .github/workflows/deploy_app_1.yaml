name: Deploy app_1

on:
  workflow_dispatch:
    inputs:
      appKey:
        type: choice
        description: 'Which app? (https://github.com/deliveryhero/pandata-ml-env/blob/master/deploy_vars.yaml)'
        required: true
        options:
        - demo_bq_access
        - menu_ranking_weighted_sum
        - competitor_data_mapping

jobs:
  some-work:
    runs-on: ubuntu-latest
    steps:
    env:
      service-account-key: $(yq '.${{ inputs.appKey }}.service_account_key' deploy_vars.yaml)

    - name: Print Environment Args
      run: |
        echo "Environment Args:"
        echo "Service Account Key: ${{env.service-account-key}}"

    outputs:
      saKey: ${{env.service-account-key}}

  call-workflow-passing-data:
    needs: some-work
    uses: ./.github/workflows/reusable.yaml
    with:
      username: app_1_username
      some_flag: true
    secrets:
      token: ${{ secrets[format('{0}', needs.some-work.outputs.saKey)] }}